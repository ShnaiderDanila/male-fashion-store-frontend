import{j as e,g as O,q as V,r as P,B as j,i as z,u as H,k as L,O as M,J as R,C as A}from"./index-D7CUuCDZ.js";import{P as D}from"./PageWrapper-DUOBqjkf.js";import{z as n,u as E,t as $,F as f,C as W}from"./index-CHpsJe1V.js";import{p as q}from"./phoneRegex-CoFneNRh.js";import{C as g}from"./CustomButton-DGMwIzAt.js";import{H as I,B as G}from"./HiddenPasswordButton-D1CuwMHz.js";import{p as k}from"./passwordRegex-DF5p1ncg.js";import{G as J}from"./GoogleAdressInput-BWxy97vd.js";import{f as U}from"./formatCreationDate-CKVnNtZc.js";import{f as _}from"./formatCost-B_6Yb-6T.js";const K=n.object({firstName:n.string().min(1,"Пожалуйста, заполните обязательное поле").refine(s=>!(s!=null&&s.includes(" ")),"В данном поле не должно быть пробелов").optional(),lastName:n.string().min(1,"Пожалуйста, заполните обязательное поле").refine(s=>!(s!=null&&s.includes(" ")),"В данном поле не должно быть пробелов").optional(),phoneNumber:n.string().regex(q,"Некорректный формат номера телефона").min(11,"Номер телефона должен состоять из 11 цифр").max(11,"Номер телефона должен состоять из 11 цифр").optional(),email:n.string().min(1,"Пожалуйста, заполните обязательное поле").email("Некорректный формат электронной почты").optional(),address:n.string({required_error:"Пожалуйста, выберите адрес из выпадющего списка"})}),Q=({isOpen:s,toggleOpen:t,title:a,children:i})=>e.jsx("div",{className:`${s?"block":"hidden"} px-5 fixed top-0 left-0 w-full h-full bg-black-overlay z-[60] flex justify-center items-center`,children:e.jsxs("div",{className:" bg-white p-5 sm:p-10 relative w-full max-w-96 sm:max-w-lg",children:[e.jsx("h2",{className:"text-center mb-5 sm:mb-10 font-semibold text-xl",children:a}),i,e.jsx("button",{onClick:t,className:"absolute -top-12 -right-3 sm:-top-11 sm:-right-12 z-[90] text-white text-5xl",children:e.jsx(O,{})})]})}),X=n.object({password:n.string().min(6,"Минимальная длина пароля - 6 символов").max(30,"Максимальная длина пароля - 30 символов").regex(k,`Пароль должен содержать хотя бы:
       одну латинскую букву (a-z), 
       одну цифру (0-9), а также  
       один специальный символ (#?!@$%^&*-).`),confirmPassword:n.string().min(6,"Минимальная длина пароля - 6 символов").max(30,"Максимальная длина пароля - 30 символов").regex(k,`Пароль должен содержать хотя бы:
       одну латинскую букву (a-z), 
       одну цифру (0-9), а также  
       один специальный символ (#?!@$%^&*-).`)}).refine(s=>s.password===s.confirmPassword,{message:"Пароли не совпадают",path:["confirmPassword"]}),Y=({toggleEditPasswordPopup:s})=>{var m,h;const[t]=V.useUpdateCurrentUserPasswordMutation(),{register:a,handleSubmit:i,formState:{errors:o,isSubmitting:r,isDirty:p,isValid:N}}=E({resolver:$(X),mode:"onChange"}),[l,c]=P.useState({password:!0,confirmPassword:!0}),x=async u=>{await t(u.password).unwrap().then(()=>{s(),j.success("Пароль успешно изменен!")}).catch(w=>{w.data?j.error(w.data.message):j.error("Ошибка сервера! Пожалуйста, повторите попытку позже.")})};return e.jsxs("form",{onSubmit:i(x),className:"mx-auto max-w-96",children:[e.jsxs("fieldset",{className:"mx-auto mb-5 flex flex-col gap-3 w-full",children:[e.jsx(f,{labelTitle:"Новый пароль*",inputId:"Новый пароль",type:l.password?"password":"text",error:(m=o.password)==null?void 0:m.message,placeholder:"Введите пароль",...a("password"),children:e.jsx(I,{hidden:l.password,setHidden:()=>c({...l,password:!l.password})})}),e.jsx(f,{labelTitle:"Повтор пароля*",inputId:"Пароль",type:l.confirmPassword?"password":"text",error:(h=o.confirmPassword)==null?void 0:h.message,placeholder:"Повторите пароль",...a("confirmPassword"),children:e.jsx(I,{hidden:l.confirmPassword,setHidden:()=>c({...l,confirmPassword:!l.confirmPassword})})})]}),e.jsx("p",{className:"mb-3",children:"* - обязательные поля для заполнения"}),e.jsx(g,{disabled:r||!p||!N,children:e.jsx("span",{children:"Изменить"})})]})},Z=()=>{var v,C,S,F;const s=z(b=>b.userReducer.currentUser),[t]=V.useUpdateCurrentUserMutation(),[a,i]=P.useState(!1),o=H(),r=L(),{register:p,handleSubmit:N,formState:{errors:l,isSubmitting:c,isDirty:x,isValid:m},reset:h,setValue:u,getValues:w,control:B}=E({resolver:$(K),mode:"onChange",defaultValues:{firstName:s==null?void 0:s.firstName,lastName:s==null?void 0:s.lastName,address:(s==null?void 0:s.address)||"",phoneNumber:s==null?void 0:s.phoneNumber,email:s==null?void 0:s.email}}),T=async b=>{await t(b).unwrap().then(d=>{r(R(d)),h({firstName:d.firstName,lastName:d.lastName,address:d.address||"",phoneNumber:d.phoneNumber,email:d.email}),j.success("Изменения сохранены!")}).catch(d=>{d.data?j.error(d.data.message):j.error("Ошибка сервера! Пожалуйста, повторите попытку позже.")})},y=()=>{i(!a),o()};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:N(T),className:"mx-auto max-w-96 lg:max-w-3xl mb-8",children:[e.jsxs("fieldset",{className:"flex flex-col gap-3 w-full mb-3",children:[e.jsx("legend",{className:"mb-3 text-lg",children:"Контактные данные"}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 items-start",children:[e.jsx(f,{labelTitle:"Имя",inputId:"Имя",error:(v=l.firstName)==null?void 0:v.message,placeholder:"Введите имя",...p("firstName"),clearField:()=>u("firstName","",{shouldValidate:!0})}),e.jsx(f,{labelTitle:"Фамилия",inputId:"Фамилия",error:(C=l.lastName)==null?void 0:C.message,placeholder:"Введите фамилию",...p("lastName"),clearField:()=>u("lastName","",{shouldValidate:!0})})]}),e.jsx("div",{className:"w-full lg:max-w-[378px]",children:e.jsx(f,{labelTitle:"Номер телефона",inputId:"Номер телефона",type:"tel",className:"w-full text-primary pl-5 pr-10 py-2 border border-gray outline-primary rounded-sm flex-1",maxLength:11,error:(S=l.phoneNumber)==null?void 0:S.message,...p("phoneNumber"),clearField:()=>u("phoneNumber","",{shouldValidate:!0}),children:e.jsx("span",{className:"absolute top-[37px] left-3",children:"+"})})})]}),e.jsxs("fieldset",{className:"w-full mb-3",children:[e.jsx("legend",{className:"mb-3 text-lg",children:"Адрес"}),e.jsx(W,{control:B,name:"address",render:({field:{onChange:b}})=>e.jsx(J,{onChange:b,defaultValue:w("address")})})]}),e.jsxs("fieldset",{className:"w-full lg:max-w-[378px] flex flex-col gap-3 mb-5",children:[e.jsx("legend",{className:"mb-3 text-lg",children:"Данные для входа"}),e.jsx(f,{labelTitle:"E-mail",inputId:"Email",type:"email",error:(F=l.email)==null?void 0:F.message,placeholder:"Введите email",...p("email"),clearField:()=>u("email","",{shouldValidate:!0})}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm relative",children:[e.jsx("label",{children:"Пароль"}),e.jsx("input",{disabled:!0,type:"password",className:"w-full text-primary-light pl-3 pr-10 min-h-[42px] border border-gray outline-primary rounded-sm flex-1 ",value:"password"}),e.jsxs("button",{onClick:y,className:"text-start flex gap-3 items-center py-3",type:"button",children:[e.jsx(G,{}),e.jsx("span",{children:"Изменить пароль"})]})]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col justify-center gap-10 lg:flex-row",children:[e.jsx(g,{type:"button",disabled:c||!m||!x,onClick:()=>h(),children:e.jsx("span",{children:"Отменить"})}),e.jsx(g,{disabled:c||!m||!x,children:e.jsx("span",{children:"Сохранить"})})]}),m&&x&&e.jsxs("div",{className:"lg:hidden fixed bottom-0 left-0 shadow-lg p-5 bg-white w-screen flex z-40 gap-3 justify-center",children:[e.jsx(g,{onClick:()=>h(),disabled:c||!m||!x,maxWidth:"45%",height:"56px",children:e.jsx(O,{className:"text-2xl"})}),e.jsx(g,{disabled:c||!m||!x,maxWidth:"45%",height:"56px",children:e.jsx(M,{className:"text-lg"})})]})]}),a&&e.jsx(Q,{isOpen:a,toggleOpen:y,title:"Изменение пароля",children:e.jsx(Y,{toggleEditPasswordPopup:y})})]})},ee=({order:s})=>{const t=[{title:"Номер заказа: ",value:s.id},{title:"Дата оформления: ",value:U(s.createdAt)},{title:"Сумма заказа: ",value:_(s.totalPrice)},{title:"Адрес доставки: ",value:s.address},{title:"Способ доставки: ",value:s.deliveryMethod}];return e.jsxs("div",{className:"flex flex-col justify-between gap-3 pb-5 border-b border-gray text-sm",children:[t.map(a=>e.jsxs("p",{children:[e.jsx("span",{className:"text-primary-light mr-1",children:a.title}),a.value]},a.title)),e.jsx("ul",{className:"flex flex-wrap gap-3",children:s.products.map((a,i)=>e.jsxs("li",{className:"lg:max-w-28 max-w-16",children:[e.jsx("div",{className:"object-cover object-center",children:e.jsx("img",{src:`http://localhost:7000/api/${a.image}`})}),e.jsxs("div",{className:"max-w-24 font-semibold text-center mx-auto mt-1",children:[e.jsx("p",{className:"truncate",children:a.size}),e.jsxs("p",{className:"truncate",children:["x",a.count]})]})]},`${a.id}${a.size}${i}`))})]})},se=()=>{const s=z(r=>r.userReducer.currentUser),[t,a]=P.useState(2),i=()=>{a(r=>r+2)},o=s&&[...s.orders].reverse();return e.jsxs("section",{className:"max-w-96 lg:max-w-3xl mx-auto",children:[e.jsx("h6",{className:"mb-3 text-lg",children:"История заказов"}),e.jsx("ul",{className:"flex flex-col gap-5",children:o&&o.slice(0,t).map(r=>e.jsx(ee,{order:r},r.id))}),e.jsx("div",{className:"mt-5",children:o&&t<o.length&&e.jsx(g,{onClick:i,children:"Загрузить еще"})})]})},xe=()=>e.jsx(D,{children:e.jsx("section",{className:"pt-10 pb-36",children:e.jsxs(A,{children:[e.jsx("h2",{className:"text-center text-2xl mb-10 font-semibold",children:"Личный кабинет"}),e.jsx(Z,{}),e.jsx(se,{})]})})});export{xe as default};
