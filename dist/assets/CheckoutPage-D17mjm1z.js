import{r as V,j as e,z as R,i as y,k as B,E as w,H as v,A as E,w as O,B as h,C as T,L as z,J as L}from"./index-BOrqkEqy.js";import{P as q}from"./PageWrapper-B1cRq7ap.js";import{z as d,u as G,t as W,F as p,C as D}from"./index-BxC8JJVE.js";import{p as H}from"./phoneRegex-CoFneNRh.js";import{C as k}from"./CustomButton-B_O74LLJ.js";import{G as J}from"./GoogleAdressInput-DgEr0uhI.js";const _=d.object({firstName:d.string().min(1,"Пожалуйста, заполните обязательное поле").refine(s=>!(s!=null&&s.includes(" ")),"В данном поле не должно быть пробелов"),lastName:d.string().min(1,"Пожалуйста, заполните обязательное поле").refine(s=>!(s!=null&&s.includes(" ")),"В данном поле не должно быть пробелов"),phoneNumber:d.string().regex(H,"Некорректный формат номера телефона").min(11,"Номер телефона должен состоять из 11 цифр"),address:d.string({required_error:"Пожалуйста, выберите адрес из выпадющего списка"}).min(1,"Пожалуйста, заполните обязательное поле"),deliveryMethod:d.string().min(1,"Пожалуйста, заполните обязательное поле")}),C=V.forwardRef(function({id:l,value:o,iconSrc:u,iconAlt:r,error:i,children:t,...n},c){return e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsxs("label",{htmlFor:l,className:"flex items-center w-full cursor-pointer p-3 rounded-sm has-[:checked]:border hover:bg-white-medium",children:[e.jsx("input",{type:"radio",id:l,value:o,ref:c,className:"hidden peer",...n}),e.jsx("div",{className:"mr-3 w-4 h-4 border rounded-full bg-transparent peer-checked:border-4"}),e.jsx("span",{className:"flex-1 mr-3",children:o}),e.jsx("img",{src:u,alt:r,className:"justify-self-end"})]}),i&&e.jsx("p",{className:"text-red text-sm",children:i}),t]})}),$=R.injectEndpoints({endpoints:s=>({createOrder:s.mutation({query:l=>({url:"/orders",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},method:"POST",body:l})})})}),K=()=>{var f,g,j,N,b;const s=y(a=>a.userReducer.currentUser),l=y(a=>a.cartReducer.products),o=B(),[u]=$.useCreateOrderMutation(),{register:r,handleSubmit:i,formState:{errors:t,isSubmitting:n,isValid:c},reset:S,setValue:x,getValues:I,control:A}=G({resolver:W(_),mode:"onChange",defaultValues:{firstName:s==null?void 0:s.firstName,lastName:s==null?void 0:s.lastName,phoneNumber:s==null?void 0:s.phoneNumber,address:s==null?void 0:s.address,deliveryMethod:"Почта России"}}),F=async a=>{const{address:M,deliveryMethod:P}=a;await u({products:l,address:M,deliveryMethod:P}).unwrap().then(m=>{S(),o(E()),o(O(m)),h.success("Ваш заказ успешно оформлен!")}).catch(m=>{m.data?h.error(m.data.message):h.error("Ошибка сервера! Пожалуйста, повторите попытку позже.")})};return e.jsxs("form",{onSubmit:i(F),className:"max-w-[500px] w-full mx-auto",children:[e.jsxs("fieldset",{className:"flex flex-col gap-3 mb-1 w-full",children:[e.jsx("legend",{className:"mb-3 text-lg",children:"1. Контактные данные"}),e.jsx(p,{labelTitle:"Имя",inputId:"Имя",error:(f=t.firstName)==null?void 0:f.message,placeholder:"Введите имя",...r("firstName"),clearField:()=>x("firstName","",{shouldValidate:!0})}),e.jsx(p,{labelTitle:"Фамилия",inputId:"Фамилия",error:(g=t.lastName)==null?void 0:g.message,placeholder:"Введите фамилию",...r("lastName"),clearField:()=>x("lastName","",{shouldValidate:!0})}),e.jsx(p,{labelTitle:"Номер телефона",inputId:"Номер телефона",type:"tel",className:"w-full text-primary pl-5 pr-10 py-2 border border-gray outline-primary rounded-sm flex-1",maxLength:11,error:(j=t.phoneNumber)==null?void 0:j.message,...r("phoneNumber"),clearField:()=>x("phoneNumber","",{shouldValidate:!0}),children:e.jsx("span",{className:"absolute top-[37px] left-3",children:"+"})})]}),e.jsxs("fieldset",{className:"flex flex-col gap-3 mb-3 w-full",children:[e.jsx("legend",{className:"mb-3 text-lg",children:"2. Адрес"}),e.jsx(D,{control:A,name:"address",render:({field:{onChange:a}})=>e.jsx(J,{onChange:a,defaultValue:I("address")})})]}),e.jsxs("fieldset",{className:"flex flex-col gap-3 mb-5",children:[e.jsx("legend",{className:"mb-3 text-lg",children:"3. Способ доставки"}),e.jsx(C,{id:"russian-post",value:"Почта России",iconSrc:w.src,iconAlt:w.alt,error:(N=t.deliveryMethod)==null?void 0:N.message,...r("deliveryMethod")}),e.jsx(C,{id:"cdek",value:"Курьерская служба СДЭК",iconSrc:v.src,iconAlt:v.alt,error:(b=t.deliveryMethod)==null?void 0:b.message,...r("deliveryMethod")})]}),e.jsx("div",{className:"mx-auto hidden lg:flex justify-center",children:e.jsx(k,{disabled:n||!c,children:e.jsx("span",{children:"Перейти к оплате"})})}),e.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 shadow-lg p-5 bg-white w-screen flex justify-center",children:e.jsx(k,{disabled:n||!c,maxWidth:"90%",height:"56px",children:e.jsx("span",{children:"Перейти к оплате"})})})]})},re=()=>e.jsx(q,{children:e.jsx("section",{className:"pt-10 pb-36",children:e.jsxs(T,{children:[e.jsx("h2",{className:"text-center text-2xl font-semibold mb-2",children:"Оформление заказа"}),e.jsxs(z,{to:"/cart",className:"flex text-center items-center gap-1 text-primary-light justify-center p-3 mb-5 text-xl max-w-fit mx-auto",children:[e.jsx(L,{}),"Вернуться в корзину"]}),e.jsx(K,{})]})})});export{re as default};
